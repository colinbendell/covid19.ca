---
title: "COVID-19 Status"
layout: layouts/home.njk
eleventyNavigation:
  key: Home
  order: 1
---

{% set css %}
  {%- for province in canada %}
    {% if province.regions and province.regions.length > 0 %}
      #vaccine-{{ province.iso3166 }}:checked ~ section > table.vaccine tr.healthregion.{{ province.iso3166 }},
      #infection-{{ province.iso3166 }}:checked ~ section > table.infection tr.healthregion.{{ province.iso3166 }},
    {% endif %}
  {%- endfor %}
  #noop { display: table-row; }
  {%- for province in canada %}
    {% if province.regions and province.regions.length > 0 %}
      #vaccine-{{ province.iso3166 }}:checked ~ section > table.vaccine tr.province.{{ province.iso3166 }} th.toggle label,
      #infection-{{ province.iso3166 }}:checked ~ section > table.infection tr.province.{{ province.iso3166 }} th.toggle label,
    {% endif %}
  {%- endfor %}
  #noop { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath fill='currentColor' d='M400 64c8.8 0 16 7.2 16 16v352c0 8.8-7.2 16-16 16H48c-8.8 0-16-7.2-16-16V80c0-8.8 7.2-16 16-16h352m0-32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-60 242c6.6 0 12-5.4 12-12v-12c0-6.6-5.4-12-12-12H108c-6.6 0-12 5.4-12 12v12c0 6.6 5.4 12 12 12h232z'/%3E%3C/svg%3E%0A"); }
{%  endset %}
<style>{{ css | cssmin | safe }}</style>
<svg xmlns="http://www.w3.org/2000/svg" style="display: none" aria-hidden="true">
  <g id="in-progress" viewBox="0 0 512 512">
    <path fill="currentColor" d="M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"/>
  </g>
  <g id="no-report-expected-today" viewBox="0 0 512 512">
    <path fill="currentColor" d="M553.5 231.8c8.7 14.9 8.7 33.4 0 48.4l-112 192c-8.6 14.7-24.4 23.8-41.5 23.8H176c-17.1 0-32.9-9.1-41.5-23.8l-112-192c-8.7-14.9-8.7-33.4 0-48.4l112-192C143.1 25.1 158.9 16 176 16h224c17.1 0 32.9 9.1 41.5 23.8l112 192zM420 296c6.6 0 12-5.4 12-12v-56c0-6.6-5.4-12-12-12H156c-6.6 0-12 5.4-12 12v56c0 6.6 5.4 12 12 12h264z"/>
  </g>
  <g id="reported" viewBox="0 0 512 512">
    <path fill="currentColor" d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/>
  </g>
  <g id="waiting-for-report" viewBox="0 0 512 512">
    <path fill="currentColor" d="M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"/>
  </g>
</svg>

{%- for province in canada %}
  <input id="vaccine-{{ province.iso3166 }}" class="toggle" type="checkbox" style="display: none">
  <input id="infection-{{ province.iso3166 }}" class="toggle" type="checkbox" style="display: none">
{%- endfor %}
<section id="main">
    {%- for country in canada | filterProp("name", "eq", "Canada") %}
    <div class="summary">
      <p>
        As of <span data-time="{{ country.updated_at }}" class="date">{{ country.updated_at | readableTime }} PT {{ country.updated_at | readableDate | lower}}</span>,
        over <strong><span class="number" title="{{ country.total.total_cases | format }}"><a href="#infections">{{ country.total.total_cases | formatNumber(false, 0) }}</a></span> Canadians have tested positive</strong> for COVID-19.
{#        or <span class="number ratio"><a href="#infections">{{ (((country.today.total_cases / country.population * 100 * 10) | round) / 10 )| format }} %</a></span> of the population.#}
        Sadly, <strong><span class="number" title="{{ country.today.total_fatalities | format }}"><a href="#infections">{{ country.today.total_fatalities | formatNumber(false, 0) }}</a></span> have died</strong>.
      </p>
      <p>
        In the last day, <strong><span class="number" title="{{ (country.today.change_cases or country.yesterday.change_cases) | format }}"><a href="#vaccinations">{{ (country.today.change_cases or country.yesterday.change_cases) | formatNumber(false, 0) }}</a></span> new infections</strong>
        have been reported and <strong><span class="number"><a href="#vaccinations">{{ country.today.change_fatalities or country.yesterday.change_fatalities }}</a></span> deaths</strong>.
        This is trending <strong><span class="editorial {{ "negative" if country.infection.changeInCasesRate > 0 else "positive" }}">{{ "downwards" if country.infection.changeInCasesRate < 0 else "upwards" }}</span></strong>.
      </p>
      <p>
        Fortunately, <strong><span class="number" title="{{ country.today.total_vaccinations | format }}"><a href="#vaccinations">{{ country.today.total_vaccinations | formatNumber(false, 0) }}</a></span> doses</strong> of the vaccine have been administered.
        Of those 16 years and older, <span class="number"><a href="#vaccinations">{{ (country.today.total_first_vaccination / country.population15plus * 100) | round(1) }}%</a></span> have their 1st shot
        and <span class="number"><a href="#vaccinations">{{ (country.today.total_vaccinated / country.population15plus * 100) | round(1) }}%</a></span> are fully vaccinated!
      </p>
      <p>
        Vaccination is <span class="editorial {{ "positive" if country.today.change_vaccinationsHalfPerCapita > 0 else "negative" }}">{{ "speeding up" if country.today.change_vaccinationsHalfPerCapita > 0 else "slowing down" }}</span>,
        but there are <strong><span class="number" title="{{ country.today.available_doses | format }}"><a href="#vaccinations">{{ country.today.available_doses | formatNumber(false, 0) }}</a></span> doses in the freezer</strong>.
        It currently takes ~<strong><span class="number"><a href="#vaccinations">{{ (country.lastWeekExclusive.available_doses_sum / country.lastWeekExclusive.change_vaccinations_sum + 0.5) | round | format }}</a></span> days</strong>
        for new deliveries to get into arms.
        At the current rate of <strong><span class="number" title="{{ country.lastWeekExclusive.change_vaccinations_avg | round | format }}"><a href="#vaccinations">{{ country.lastWeekExclusive.change_vaccinations_avg | formatNumber(false, 0) }}</a></span> doses per day</strong>,
        all adult Canadians should have the first dose by <span class="number"><a href="#vaccinations">{{ country.vaccine.firstVaccinationsDate | readableDate }}</a></span>
        and fully vaccinated by <span class="number"><a href="#vaccinations">{{ country.vaccine.fullVaccinatedDate | readableDate }}</a></span>.
        There is no approved vaccine for children aged 15 or younger.
      </p>
  </div>
  <ul class="stats flex nowrap">
    <li>
      {% set vaccinatedPerPopulation = (country.today.total_vaccinated / country.population15plus * 100) | round %}
      {% set firstDoesPerPopulation = (country.today.total_first_vaccination / country.population15plus * 100) | round %}
      {% set potentialFirstDoesPerPopulation = (( country.today.total_first_vaccination + country.today.available_doses ) / country.population15plus * 100) | round %}
      <div style="--repeat-y: 5; --repeat-x:20" class="ratiostats">
        <div style="position: absolute; --repeat-y: 5; --repeat-x:{{ (potentialFirstDoesPerPopulation / 5) | int}}; --repeat-color: repeating-linear-gradient( 135deg, var(--gray-dark), var(--gray-dark) 1px, var(--light) 1px, var(--light) 2px );" class="ratiostats"></div>
        <div style="position: absolute; --repeat-y: {{ potentialFirstDoesPerPopulation % 5 }}; --repeat-x:{{ (potentialFirstDoesPerPopulation / 5 + 0.5) | round}}; --repeat-color: repeating-linear-gradient( 135deg, var(--gray-dark), var(--gray-dark) 1px, var(--light) 1px, var(--light) 2px );" class="ratiostats"></div>
        <div style="position: absolute; --repeat-y: 5; --repeat-x:{{ (firstDoesPerPopulation / 5) | int}}; --repeat-color: repeating-linear-gradient( 135deg, var(--blue), var(--blue) 1px, var(--light) 1px, var(--light) 2px );" class="ratiostats"></div>
        <div style="position: absolute; --repeat-y: {{ firstDoesPerPopulation % 5 }}; --repeat-x:{{ (firstDoesPerPopulation / 5 + 0.5) | round}}; --repeat-color: repeating-linear-gradient( 135deg, var(--blue), var(--blue) 1px, var(--light) 1px, var(--light) 2px );" class="ratiostats"></div>
        <div style="position: absolute; --repeat-y: 5; --repeat-x:{{ (vaccinatedPerPopulation / 5) | int }}; --repeat-color: var(--blue);" class="ratiostats"></div>
        <div style="position: absolute; --repeat-y: {{ vaccinatedPerPopulation % 5 }}; --repeat-x:{{ (vaccinatedPerPopulation / 5 + 0.5) | round}}; --repeat-color: var(--blue);" class="ratiostats"></div>
      </div>
      <div style="max-width:20rem;line-height: 1; padding-top: 0.25rem"><strong style="color: var(--blue);">{{ vaccinatedPerPopulation }} in 100</strong> adults are vaccinated,
        <br/><strong style="color: var(--blue);">{{ firstDoesPerPopulation }} in 100</strong> have a 1st dose and
        <strong style="color: #000;">{{ potentialFirstDoesPerPopulation - firstDoesPerPopulation }} in 100</strong> more could receive a dose from freezer</div>
    </li>
    <li>
      {% set maxVal = country.today.total_criticals %}
      {%- for week in country.previousWeeks %}
        {% set maxVal %}{{ week.total_criticals_avg | max(maxVal) }}{% endset %}
      {%- endfor %}
      <table class="charts-css column" style="--color-1: var(--pink); --size: {{ (country.lastWeekExclusive.active_cases_avg / country.infection.maxActiveCases) | format }}" data-trendline="{{ country.lastWeekExclusive.active_cases_avg |formatNumber }} /day">
        <tbody>
        <tr>
          {%- for week in country.previousWeeks  %}
            <td style="--size:{{ (week.total_criticals_avg / maxVal) | max(0.03) | format}};"><span class="tooltip">Week of {{ week.start | readableDate }}<br/>Hospitalized avg: {{ week.total_hospitalizations_avg | formatNumber }}/day<br/>In ICU Avg: {{ week.total_criticals_avg | formatNumber }}/day</span></td>
          {%- endfor %}
          <td style="--size:{{ (country.today.total_criticals / maxVal) | max(0.03) | format }};"><span class="tooltip">{{ country.today.date | readableDate }}<br/>Hospitalization: {{ country.today.total_hospitalizations | d(0) | formatNumber }}<br/>in ICU: {{ country.today.total_criticals | d(0) | formatNumber }}</span></td>
        </tr>
        </tbody>
      </table>
      <div>{{ country.today.total_criticals | d(0) | format }} in ICU ({{ country.today.total_hospitalizations | d(0) | format }} in the hospital)</div>
    </li>
  </ul>
    {%- endfor %}
</section>
<section id="vaccinations">
  <h2><a href="#vaccinations">Vaccine Status</a></h2>
<table class="status vaccine table table-hover" width="100%" cellspacing="0">
  <thead>
  <tr>
    <th></th>
    <th></th>
    <th>Doses In Arms<br/>Past 60 Days</th>
    <th>Doses In Arms<br/>Today</th>
    <th>Projected<br/>Completion</th>
    <th>Total</th>
    <th>1st Dose /<br/>Population</th>
    <th>Fully Vacc. /<br/>Population</th>
    <th>In Freezers<br/>Past 60 Days</th>
    <th>In Freezers<br/>Today</th>
    <th>In Freezers /<br/>Population</th>
    <th>Time from <br/>Delivery to Arm</th>
  </tr>
  </thead>
  <tbody id="vaccinationsProvinceTable">
  {% macro vaccineRow(data, type='province') %}
    {% if data.today.total_vaccinations > 0 %}
    <tr class="vaccine {{ type }} {{ data.iso3166 or data.province }} {{ data.today.date | readableDate | lower }}"
        title="Total: {{ data.today.total_vaccinations | d(0) | format }} ({{ data.today.date | readableDate }}: {{ data.today.change_vaccinations | format}}, {{ data.yesterday.date | readableDate }}: {{ data.yesterday.change_vaccinations | format }}) Population: {{ data.population | format }}">
      <th class="toggle">
        {% if type === 'province' and data.regions.length > 0 %}
          {% set regionLength %}{% for region in data.regions %}{% if region.today.total_vaccinations > 0 %}1{% endif %}{% endfor %}{% endset %}
          {% if regionLength > 0 %}
        <label for="vaccine-{{ data.iso3166 }}" class="label-toggle"></label>
          {% endif %}
        {% endif %}
      </th>
      <th class="name" title="{{ data.data_status }} @ {{ data.updated_at | readableTime }} PT {{ data.updated_at | readableDate | lower}}">
      {% if type === 'province' or type === 'country' %}
        <label for="vaccine-{{ data.iso3166 }}" class="label-toggle">
          <span class="name long" data-short="{{ data.iso3166 or data.name.en }}">{{ data.name.en or data.name }}</span>
          <span class="name short">{{ data.iso3166 or data.name.en }}</span>
          <svg viewBox="0 0 512 512" class="province-update-status"><use href="#{{ data.data_status | lower | replace(r/ /gi, '-') }}"></use></svg>
        </label>
      {% else %}
{#      <span class="name long">{{ data.name.en or data.name }}</span>#}
        <label class="label-toggle">
          <span class="name">{{ data.iso3166 or data.short or data.name.en or data.name }}</span>
        </label>
      {% endif %}
        <div class="small-detail reveal-on-hover">{{ data.population | formatNumber(false, 0) }}</div>
      </th>
      <td class="dose history">
        <div>
          <table class="charts-css column multiple stacked" style="--size: {{ (data.lastWeekExclusive.change_vaccinations_avg / data.vaccine.maxVaccinations) | format }}" data-trendline="{{ data.lastWeekExclusive.change_vaccinations_avg |formatNumber }} /day">
            <tbody>
            {%- for week in data.previousWeeks | head(-8) | head(7) %}
            <tr>
              <td style="--size:{{ (week.change_first_vaccination_avg / data.vaccine.maxVaccinations) | max(0.03) | format}};"><span class="tooltip">Week of {{ week.start | readableDate }}<br/>Avg: {{ week.change_vaccinations_avg | formatNumber }}/day<br/>Total: {{ week.change_vaccinations_sum | d(0) | formatNumber }}</span></td>
              <td style="--size:{{ (week.change_vaccinated_avg / data.vaccine.maxVaccinations) | max(0) | format }};" ></td>
            </tr>
            {%- endfor %}
            {%- for day in data.previous7Days %}
            <tr>
              <th scope="row">{{ day.date | readableDate }}</th>
              <td style="--size:{{ (day.change_first_vaccination / data.vaccine.maxVaccinations) | max(0.03) | format }};"><span class="tooltip">{{ day.date | readableDate }}{% if day.change_first_vaccination > day.change_vaccinations %}<br/>1st: {{ day.change_first_vaccination | d(0) | formatNumber }}<br/>2nd: {{ day.change_vaccinationed | d(0) | formatNumber }}{% endif %}<br/>Total: {{ day.change_vaccinations | d(0) | formatNumber }}</span></td>
              <td style="--size:{{ (day.change_vaccinated / data.vaccine.maxVaccinations) | max(0) | format }};"></td>
            </tr>
            {%- endfor %}
            <tr>
              <th scope="row">{{ data.today.date | readableDate }}</th>
              <td style="--size:{{ (data.today.change_first_vaccination / data.vaccine.maxVaccinations) | max(0.03) | format }};"><span class="tooltip">{{ data.today.date | readableDate }}{% if data.today.change_first_vaccination > data.today.change_vaccinations %}<br/>1st: {{ data.today.change_first_vaccination | d(0) | formatNumber }}<br/>2nd: {{ data.today.change_vaccinationed | d(0) | formatNumber }}{% endif %}<br/>Total: {{ data.today.change_vaccinations | d(0) | formatNumber }}</span></td>
              <td style="--size:{{ (data.today.change_vaccinated / data.vaccine.maxVaccinations) | max() | format }};"></td>
            </tr>
            </tbody></table>

        </div>
      </td>
      <td class="dose current"
          title="{{ data.today.date | readableDate | lower }}, {{ (data.today.change_vaccinations | format) if data.today.change_vaccinations else "NO"}} doses were administered. The 7 day average is {{ data.lastWeekExclusive.change_vaccinations_avg | format }} doses per day."
        >
        <div class="data-rate" data-rate="{{ data.vaccine.changeInVaccinationRate }}">{{ (data.today.change_vaccinations if data.today.change_vaccinations > 0 else data.lastWeekExclusive.change_vaccinations_avg) | formatNumber }}</div>
        <div class="small-detail reveal-on-hover">Total: {{ data.today.total_vaccinations | d(0) | formatNumber }}</div>
      </td>
      <td class="supply complete {{ "bad" if data.vaccine.daysToFirstVaccinations > 15 else ( "ok" if data.vaccine.daysToFirstVaccinations > 5 else "good") }}"
          title="First dose expected to be completed around {{ data.vaccine.firstVaccinationsDate | readableDate }} and full vaccination around {{ data.vaccine.fullVaccinatedDate | readableDate }} based on a trailing average of {{ data.lastWeekExclusive.change_first_vaccination_avg | formatNumber }} and {{ data.lastWeekExclusive.change_vaccinated_avg | formatNumber }} doses per day, respectively."
        >{{ data.vaccine.firstVaccinationsDate | readableDate(false) if data.vaccine.daysToFirstVaccinations > 0 }}</td>
      <td class="dose total center"
          title="Total doses administered: {{ data.today.total_vaccinations | d(0) | formatNumber }}"
        >{{ data.today.total_vaccinations | d(0) | formatNumber }}</td>
      <td class="dose one"
        title="{{ ((data.today.total_first_vaccination / data.population15plus * 100) | round(1)) or "N/A" }}% of {{ data.population15plus | formatNumber(false, 0) }} eligible adults have their first dose.">
        <div class="progressbar" role="progressbar" aria-valuenow="{{ (data.today.total_first_vaccination / data.population15plus * 100) | round(1) or "N/A" }}"
             data-value="{{ data.today.total_first_vaccination | max(0) | formatNumber }}">
          <span class="value" aria-hidden="true" style="width: {{ data.today.vaccinationsHalfPerCapita}}%"></span>
          {% if data.today.change_vaccinationsHalfPerCapita > 0 %}<span class="change percent" data-value="{{ data.today.change_vaccinationsHalfPerCapita | format }}"></span>{% endif %}
          {% if data.today.change_first_vaccination > 0 %}<span class="change absolute" data-value="{{ data.today.change_first_vaccination | format }}"></span>{% endif %}
        </div>
      </td>
      <td class="dose full"
          title="{{ ((data.today.total_vaccinated / data.population15plus * 100) | round(1)) or "N/A" }}% of {{ data.population15plus | formatNumber(false, 0) }} eligible adults are fully vaccinated.">
        <div class="progressbar" role="progressbar" aria-valuenow="{{ (data.today.total_vaccinated / data.population15plus * 100) | round(1) or "N/A" }}" data-value="{{ data.today.total_vaccinated | formatNumber }}"><span class="value" aria-hidden="true" style="width: {{ data.today.vaccinationsCompletePerCapita or 0 }}%"></span>
          {% if data.today.change_vaccinationsCompletePerCapita > 0 %}<span class="change percent" data-value="{{ data.today.change_vaccinationsCompletePerCapita | format }}"></span>{% endif %}
          {% if data.today.change_vaccinated > 0 %}<span class="change absolute" data-value="{{ data.today.change_vaccinated | format }}"></span>{% endif %}
        </div>
      </td>
      <td class="supply history">
        {% if data.today.available_doses > 0 %}
        <div>
          <table class="charts-css column" style="--size: {{ (data.lastWeekExclusive.available_doses_avg / data.vaccine.maxAvailableDoses) | format }}" data-trendline="{{ data.lastWeekExclusive.available_doses_avg |formatNumber }}">
            <tbody>
            <tr>
              {%- for week in data.previousWeeks | head(-8) | head(7) %}
                <td style="--size:{{ (week.available_doses_avg / data.vaccine.maxAvailableDoses) | max(0.03) | format}};"><span class="tooltip">Week of {{ week.start | readableDate }}<br/>Avg in freezer: {{ week.available_doses_avg | formatNumber }}/day</span></td>
              {%- endfor %}
              {%- for day in data.previous7Days %}
                <td style="--size:{{ (day.available_doses / data.vaccine.maxAvailableDoses) | max(0.03) | format }};"><span class="tooltip">{{ day.date | readableDate }}<br/>In Freezer: {{ day.available_doses | d(0) | formatNumber }}</span></td>
              {%- endfor %}
              <td style="--size:{{ (data.today.available_doses / data.vaccine.maxAvailableDoses) | max(0.03) | format }};"><span class="tooltip">{{ data.today.date | readableDate }}<br/>In Freezer: {{ data.today.available_doses | d(0) | formatNumber }}</span></td>
            </tr>
            </tbody>
          </table>
        </div>
        {% endif %}
      </td>
      <td class='supply available today center'
          {% if data.today.available_doses > 0 %}
          title="{{ data.today.available_doses | formatNumber }} doses are in freezers, waiting to be administered"
          {% endif %}
      >{{ data.today.available_doses | formatNumber }}</td>
      <td class='supply population'>
        {% if data.today.available_doses > 0 %}
        <div class="progressbar supply darkgray" role="progressbar" aria-valuenow="{{ ((data.today.available_doses / data.population15plus * 100) | round(1)) }}" data-value="{{ data.today.available_doses | formatNumber }}"
             title="{{ data.today.available_doses | formatNumber }} doses provides 1 dose for {{ (data.today.available_doses / data.population15plus * 100) | round(1) }}% of the population"
        >
          <span class="value" aria-hidden="true" style="width: {{ ((data.today.available_doses / data.population15plus * 100) / 25 * 100)  | min (100) }}%"></span>
          {% set change_available_doses_per_capita = (data.today.available_doses / data.population15plus * 100) - (data.yesterday.available_doses / data.population15plus * 100) %}
          {% if change_available_doses_per_capita %}<span class="change percent" data-value="{{ change_available_doses_per_capita | round(1) | format }}"></span>{% endif %}
          {% if data.today.change_available_doses %}<span class="change absolute" data-value="{{ data.today.change_available_doses | format }}"></span>{% endif %}
        </div>
        {% endif %}
      </td>
{#      {% if data.today.available_doses > 0 %}#}
{#        {% set vaccineDays %}{{ (data.lastWeekExclusive.available_doses_sum / data.lastWeekExclusive.change_vaccinations_sum + 0.5) | round }}{% endset %}#}
{#        <span class="supply zero {{ "bad" if vaccineDays > 10 else ( "ok" if vaccineDays >= 7 else "good") }}">{{ vaccineDays | format }}</span>#}
{#      {% endif %}#}
      <td class='supply days'>
      {% if data.today.available_doses > 0 %}
        {% set vaccineDays %}{{ (data.lastWeekInclusive.available_doses_sum / data.lastWeekInclusive.change_vaccinations_sum + 0.5) | round }}{% endset %}
        {% set previousVaccineDays %}{{ (data.lastWeekExclusive.available_doses_sum / data.lastWeekExclusive.change_vaccinations_sum + 0.5) | round }}{% endset %}

        <div class="progressbar supply days {{ "red" if vaccineDays > 10 else ( "orange" if vaccineDays > 7 else "green") }}" role="progressbar" aria-valuenow="{{ vaccineDays }}"
             title="It takes {{ vaccineDays }} days for new vaccine deliveries to be administered to waiting arms. The target should be 7 days with regular weekly shipments."
        >
          <span class="value" aria-hidden="true" style="width: {{ (vaccineDays/20*100) | min (100) }}%"></span>
          {% if (vaccineDays - previousVaccineDays) !== 0 %}<span class="change percent days" data-value="{{ (vaccineDays - previousVaccineDays) | round | format }}"></span>{% endif %}
        </div>
      {% endif %}
      </td>
    </tr>
  {%  endif %}
  {%  endmacro %}
  {%- for province in canada | filterProp("name", "eq", "Canada")  %}
    {{ vaccineRow(province, "country") }}
  {%- endfor %}
  {%- for province in canada | filterProp("name", "neq", "Canada") | sort(true, attr="population") %}
  {{ vaccineRow(province) }}
    {%- for region in province.regions | sort(true, attr="population") %}
      {{ vaccineRow(region, "healthregion") }}
    {%- endfor %}
  {%- endfor %}
  </tbody>
  <tfoot id="vaccinationsProvinceTableFooter">
  </tfoot>
</table>
</section>
<section id="infections">
  <h2><a href="#infections">Infection Status</a></h2>
<table class="status infection table table-hover" width="100%" cellspacing="0">
  <thead>
  <tr>
    <th></th>
    <th></th>
    <th>New Cases<br/>(60 days)</th>
    <th>New Cases<br/>Today</th>
    <th>Active Cases<br/>(60 days)</th>
    <th>Current<br>Active/₁₀₀ₖ</th>
    <th>Current<br>Hospital/₁₀₀₀ₖ</th>
    <th>Total<br>Deaths/₁₀₀ₖ</th>
    <th>Test-Positivity<br/>Rate (7 days)</th>
    <th class="infected">Infected /<br>Population</th>
    <th class="infected">Death Rate <br>(of Infected)</th>
  </tr>
  </thead>
  <tbody id="casesProvinceTable">
  {% macro selectColour(data) %}{{ "green" if data < 10 else ("yellow" if data < 25 else ("orange" if data < 40 else ("red" if data < 100 else "darkgray"))) }}{% endmacro %}
  {% macro selectBase(data) %}{{ 10 if data < 10 else (25 if data < 25 else (40 if data < 40 else (100 if data < 100 else 150))) }}{% endmacro %}

  {% macro infectionRow(data, type='province') %}
    <tr class="infection {{ type }} {{ data.iso3166 if data.iso3166 else data.province }} {{ data.today.date | readableDate | lower }}" title="Total: {{ data.total.total_cases | format }} ({{ data.total.date | readableDate }}: {{ data.total.change_cases | format }}, {{ data.yesterday.date | readableDate }}: {{ data.yesterday.change_cases | format }}) Population: {{ data.population | format }}">
      <th class="toggle">
        {% if type === 'province' and data.regions.length > 0 %}
          <label for="infection-{{ data.iso3166 }}" class="label-toggle"></label>
        {% endif %}
      </th>
      <th class="name" title="{{ data.data_status }} @ {{ data.updated_at | readableTime }} PT {{ data.updated_at | readableDate | lower}}">
        {% if type === 'province' or type === 'country' %}
        <label for="infection-{{ data.iso3166 }}" class="label-toggle">
          <span class="name long">{{ data.name.en or data.name }}</span>
          <span class="name short">{{ data.iso3166 or data.name.en }}</span>
          <svg viewBox="0 0 512 512" class="province-update-status"><use href="#{{ data.data_status | lower | replace(r/ /gi, '-') }}"></use></svg>
        </label>
        {% else %}
{#        <span class="name long">{{ data.name.en or data.name }}</span>#}
        <label class="label-toggle">
          <span class="name">{{ data.iso3166 or data.short or data.name.en or data.name }}</span>
        </label>
        {% endif %}
        <div class="small-detail reveal-on-hover">{{ data.population | formatNumber(false, 0) }}</div>
      </th>
      <td class="cases history">
        <div>
          <table class="charts-css column" style="--size: {{ (data.lastWeekExclusive.change_cases_avg / data.infection.maxChangeCases) | format }}" data-trendline="{{ data.lastWeekExclusive.change_cases_avg |formatNumber }} /day">
            <tbody>
            <tr>
              {%- for week in data.previousWeeks | head(-8) | head(7) %}
              <td style="--size:{{ (week.change_cases_avg / data.infection.maxChangeCases) | max(0.03) | format}};"><span class="tooltip">Week of {{ week.start | readableDate }}<br/>Avg: {{ week.change_cases_avg | formatNumber }}/day<br/>Total: {{ week.change_cases_sum | d(0) | formatNumber }}</span></td>
              {%- endfor %}
              {%- for day in data.previous7Days %}
              <td style="--size:{{ (day.change_cases / data.infection.maxChangeCases) | max(0.03) | format }};"><span class="tooltip">{{ day.date | readableDate }}<br/>Total: {{ day.change_cases | d(0) | formatNumber }}</span></td>
              {%- endfor %}
              <td style="--size:{{ (data.today.change_cases / data.infection.maxChangeCases) | max(0.03) | format }};"><span class="tooltip">{{ data.today.date | readableDate }}<br/>Total: {{ data.today.change_cases | d(0) | formatNumber }}</span></td>
            </tr>
            </tbody>
          </table>
        </div>
      </td>
      <td class="activecases current"
          title="There were {{ (data.today.change_cases | format) if data.today.change_cases else "NO"}} cases {{ data.today.date | readableDate | lower }}. With a 7 day average of {{ data.lastWeekExclusive.change_cases_avg | format }} cases per day. {{ (data.today.change_recoveries or data.lastWeekExclusive.change_recoveries_avg) | round | format }} cases were closed."
      >
        <div class="data-rate golf" data-rate="{{ data.infection.changeInCasesRate }}">{{ (data.today.change_cases if data.today.change_cases > 0 else data.lastWeekExclusive.change_cases_avg) | formatNumber }}</div>
        <div class="small-detail reveal-on-hover">Closed: {{ (data.today.change_recoveries or data.lastWeekExclusive.change_recoveries_avg) | round | formatNumber }}</div>
      </td>
      <td class="activecases history">
        <div>
          <table class="charts-css column" style="--size: {{ (data.lastWeekExclusive.active_cases_avg / data.infection.maxActiveCases) | format }}" data-trendline="{{ data.lastWeekExclusive.active_cases_avg |formatNumber }} /day">
            <tbody>
            <tr>
              {%- for week in data.previousWeeks | head(-8) | head(7) %}
              <td style="--size:{{ (week.active_cases_avg / data.infection.maxActiveCases) | max(0.03) | format}};"><span class="tooltip">Week of {{ week.start | readableDate }}<br/>Active Cases Avg: {{ week.active_cases_avg | formatNumber }}/day<br/>Hospitalization: {{ week.total_hospitalizations_avg | d(0) | formatNumber }}</span></td>
              {%- endfor %}
              {%- for day in data.previous7Days %}
              <td style="--size:{{ (day.active_cases / data.infection.maxActiveCases) | max(0.03) | format }};"><span class="tooltip">{{ day.date | readableDate }}<br/>Active Cases: {{ day.active_cases | d(0) | formatNumber }}</span></td>
              {%- endfor %}
              <td style="--size:{{ (data.today.active_cases / data.infection.maxActiveCases) | max(0.03) | format }};"><span class="tooltip">{{ data.today.date | readableDate }}<br/>Active Cases: {{ data.today.active_cases | d(0) | formatNumber }}</span></td>
            </tr>
            </tbody>
          </table>
        </div>
      </td>
      <td class="activecases per100k">
        <div class="progressbar per100k {{ selectColour(data.today.activePer100k)  }}" aria-valuenow="{{ data.today.activePer100k }}" data-value="{{ data.today.active_cases | formatNumber }}" data-change="{{ data.today.change_active_cases | format }}">
          <span class="value" aria-hidden="true" style="width: {{ (data.today.activePer100k/selectBase(data.today.activePer100k)*100) | min(100) }}%"></span>
          {% if data.today.change_activePer100k != 0 %}<span class="change percent per100k" data-value="{{ data.today.change_activePer100k | format }}"></span>{% endif %}
          {% if data.today.change_active_cases != 0 %}<span class="change absolute" data-value="{{ data.today.change_active_cases | format }}"></span>{% endif %}
        </div>
      </td>
      <td class="hospitalized per1000k">
        <div class="progressbar per1000k {{ selectColour(data.today.hospitalizedPer1000k) }}" aria-valuenow="{{ data.today.hospitalizedPer1000k if data.today.total_hospitalizations >= 0 else "N/A"}}" data-value="{{ data.today.total_hospitalizations | formatNumber }}">
          {% if data.today.total_hospitalizations > 0 %}
          <span class="value" aria-hidden="true" style="width: {{ (data.today.hospitalizedPer1000k/selectBase(data.today.hospitalizedPer1000k)*100) | min(100) }}%"></span>
          {% if data.today.change_hospitalizedPer1000k != 0 %}<span class="change percent per1000k" data-value="{{ data.today.change_hospitalizedPer1000k | format }}"></span>{% endif %}
          {% if data.today.change_hospitalizations != 0 %}<span class="change absolute" data-value="{{ data.today.change_hospitalizations | format }}"></span>{% endif %}
          {% endif %}
        </div>
      </td>
      <td class="death per100k">
        <div class="progressbar per100k red" role="progressbar" aria-valuenow="{{ data.today.fatalitiesPer100k }}" data-value="{{ data.today.total_fatalities | formatNumber }}"><span class="value" aria-hidden="true" style="width: {{ data.today.fatalitiesPer100k | min(100) }}%"></span>
          {% if data.today.change_fatalitiesPer100k != 0 %}<span class="change percent per100k" data-value="{{ data.today.change_fatalitiesPer100k | format }}"></span>{% endif %}
          {% if data.today.change_fatalities != 0  %}<span class="change absolute" data-value="{{ data.today.change_fatalities | format }}"></span>{% endif %}
        </div>
      </td>
      <td class="positivity">
        <div class="progressbar orange" role="progressbar" aria-valuenow="{{ data.lastWeekInclusive.positivity_rate if data.lastWeekInclusive.change_tests_sum >= 0 else "N/A" }}" data-value="{{ data.lastWeekInclusive.change_tests_sum | formatNumber }}">
          <span class="value" aria-hidden="true" style="width: {{ ((data.lastWeekInclusive.positivity_rate or 0)/10*100) | min(100) }}%"></span>
          <span class="change percent" data-value="{{ data.lastWeekInclusive.change_positivity_rate | d(0) | format }}"></span>
          <span class="change absolute" data-value="{{ data.lastWeekInclusive.change_change_tests_sum | d(0) | format }}"></span>
        </div>
      </td>
      <td class="infected percapita">
        <div class="progressbar orange" role="progressbar" aria-valuenow="{{ data.today.casesPerCapita }}" data-value="{{ data.today.total_cases | formatNumber }}">
          <span class="value" aria-hidden="true" style="width: {{ (data.today.casesPerCapita/10*100) | d(0) | min(100) }}%"></span>
          <span class="change percent" data-value="{{ data.today.change_casesPerCapita | d(0) | format }}"></span>
          <span class="change absolute" data-value="{{ data.today.change_cases | d(0) | format }}"></span>
        </div>
      </td>
      <td class="infected death">
        <div class="progressbar red" role="progressbar" aria-valuenow="{{ data.today.deathsPerCase }}" data-value="{{ data.today.total_fatalities | formatNumber }}">
          <span class="value" aria-hidden="true" style="width: {{ (data.today.deathsPerCase/4*100) | d(0) | min(100) }}%"></span>
          <span class="change percent" data-value="{{ (data.today.deathsPerCase - data.lastWeekExclusive.deathsPerCase_avg ) | d(0) | format }}"></span>
          <span class="change absolute" data-value="{{ data.today.change_fatalities | d(0) | format }}"></span>
        </div>
      </td>
    </tr>
  {%  endmacro %}

  {%- for province in canada | filterProp("name", "eq", "Canada")  %}
    {{ infectionRow(province, "country") }}
  {%- endfor %}
  {%- for province in canada | filterProp("name", "neq", "Canada") | sort(true, attr="population") %}
    {{ infectionRow(province) }}
    {%- for region in province.regions | sort(true, attr="population") %}
      {{ infectionRow(region, "healthregion") }}
    {%- endfor %}
  {%- endfor %}
  </tbody>
  <tfoot>
  </tfoot>
</table>
</section>
